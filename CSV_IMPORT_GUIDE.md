# CSVインポート/エクスポート機能ガイド

## 概要

agm_lpac_attendanceでは、管理者がCSV形式でユーザーや参加者を一括管理できます。

## 機能一覧

### 1. 参加者CSVエクスポート 📥
全参加者の情報をCSVファイルとしてダウンロード

### 2. 参加者CSVインポート 📤
複数の参加者情報を一括で登録/更新

### 3. ユーザーCSVインポート 👥
複数のユーザーアカウントを一括作成

## 使用方法

### 参加者CSVエクスポート

1. 管理者でログイン
2. 管理者ダッシュボードを開く
3. 「📥 参加者一覧をCSV出力」ボタンをクリック
4. ファイルがダウンロードされます：`agm_lpac_participants.csv`

**出力フォーマット:**
```csv
ユーザー名,役職,名前,メール,質問,AGMステータス,LPACステータス
user1,部長,山田太郎,yamada@example.com,特になし,出席,出席
user2,課長,佐藤花子,sato@example.com,駐車場について,出席,欠席
```

### 参加者CSVインポート

#### ステップ1: CSVファイルを作成

テンプレート: `participants_template.csv`

**フォーマット:**
```csv
ユーザー名,役職,名前,メール,質問,AGMステータス,LPACステータス
user1,部長,山田太郎,yamada@example.com,特になし,出席,出席
user2,課長,佐藤花子,sato@example.com,駐車場について,出席,欠席
user1,係長,鈴木一郎,suzuki@example.com,,欠席,欠席
```

**必須項目:**
- ユーザー名（既存のユーザーである必要があります）
- 役職
- 名前
- メール

**オプション項目:**
- 質問（空欄可）
- AGMステータス（「出席」または「欠席」、空欄可）
- LPACステータス（「出席」または「欠席」、空欄可）

#### ステップ2: ファイルを保存

- **Excel**: 「CSV UTF-8（コンマ区切り）」形式で保存
- **Google Sheets**: ファイル → ダウンロード → カンマ区切り値（.csv）
- **テキストエディタ**: UTF-8 with BOM で保存

#### ステップ3: インポート実行

1. 管理者ダッシュボードを開く
2. 「📤 参加者CSVインポート」ボタンをクリック
3. 作成したCSVファイルを選択
4. 「📤 インポート実行」ボタンをクリック
5. 結果を確認

**動作:**
- 新しい参加者は追加されます
- 既存の参加者（同じ名前 + ユーザーID）は更新されます
- エラーがある行はスキップされ、エラーメッセージが表示されます

### ユーザーCSVインポート

#### ステップ1: CSVファイルを作成

テンプレート: `users_template.csv`

**フォーマット:**
```csv
ユーザー名,パスワード,ロール
yamada,SecurePass123,user1
tanaka,AnotherPass456,user2
admin2,AdminPassword789,admin
```

**必須項目:**
- ユーザー名（一意である必要があります）
- パスワード

**オプション項目:**
- ロール（省略時は「user1」）
  - `admin`: 管理者（全機能）
  - `user1`: AGM出席管理のみ
  - `user2`: AGM + LPAC出席管理

#### ステップ2: ファイルを保存

- UTF-8 BOM形式で保存
- Excel: 「CSV UTF-8（コンマ区切り）」

#### ステップ3: インポート実行

1. 管理者ダッシュボードを開く
2. 「👥 ユーザーCSVインポート」ボタンをクリック
3. 作成したCSVファイルを選択
4. 「📤 インポート実行」ボタンをクリック
5. 結果を確認

**動作:**
- 新しいユーザーが作成されます
- 既存のユーザー名はスキップされます
- パスワードはハッシュ化されて保存されます

⚠️ **セキュリティ注意:**
- このファイルには平文パスワードが含まれます
- インポート後は必ずファイルを削除してください
- ユーザーには初回ログイン後のパスワード変更を推奨してください

## エラー対処

### よくあるエラー

#### 「ユーザー 'xxx' が見つかりません」
**原因:** 参加者CSVで指定したユーザー名が存在しない

**解決策:**
1. `python list_users.py` でユーザー一覧を確認
2. 存在しないユーザーは先に作成する
3. または、ユーザーCSVインポートで一括作成

#### 「ファイルが選択されていません」
**原因:** CSVファイルが選択されていない

**解決策:**
- ファイル選択ボタンで正しくファイルを選択してください

#### 「CSVファイルを選択してください」
**原因:** .csv以外のファイルが選択された

**解決策:**
- ファイルの拡張子が `.csv` であることを確認

#### 文字化け
**原因:** 文字エンコーディングが正しくない

**解決策:**
- UTF-8 BOM形式で保存してください
- Excel: 「CSV UTF-8（コンマ区切り）」を選択
- テキストエディタ: エンコーディングを「UTF-8 with BOM」に設定

## ベストプラクティス

### 1. 段階的インポート

大量のデータをインポートする場合:
1. まず小さなテストファイル（3-5行）で試す
2. 正常に動作することを確認
3. 本番データをインポート

### 2. バックアップ

インポート前に:
1. 現在のデータをCSVエクスポートでバックアップ
2. 問題があれば復元可能にする

### 3. データ検証

インポート後に:
1. 管理者ダッシュボードでデータを確認
2. 件数が正しいか確認
3. サンプルデータをチェック

### 4. セキュリティ

ユーザーCSVインポート後:
1. CSVファイルをすぐに削除
2. ユーザーに初期パスワード変更を通知
3. 強力なパスワードを使用する

## 便利な使い方

### 使用例1: 新規イベントのセットアップ

1. ユーザーCSVで参加企業のアカウントを一括作成
2. 各ユーザーにログイン情報を配布
3. 各ユーザーが自分の参加者を登録

### 使用例2: 既存データの一括更新

1. 参加者データをCSVエクスポート
2. Excelで一括編集（ステータス変更など）
3. 編集したCSVを再インポート

### 使用例3: 他システムからの移行

1. 既存システムからデータをCSV出力
2. フォーマットを合わせる
3. ユーザーと参加者を順番にインポート

## トラブルシューティング

### インポートが完了しない

**症状:** ローディングが終わらない

**解決策:**
1. ファイルサイズを確認（大きすぎる場合は分割）
2. ブラウザのコンソールでエラーを確認
3. サーバーログを確認

### 一部のデータがインポートされない

**症状:** X件中Y件のみインポート

**解決策:**
1. エラーメッセージを確認
2. スキップされた行を特定
3. データを修正して再インポート

### 日本語が文字化け

**症状:** CSVの日本語が正しく表示されない

**解決策:**
1. UTF-8 BOM形式で保存
2. Excelの場合「CSV UTF-8」を選択
3. テキストエディタでBOMを確認

## まとめ

CSVインポート/エクスポート機能により:
- ✅ 大量のデータを効率的に管理
- ✅ Excelでの一括編集が可能
- ✅ 他システムとのデータ連携が容易
- ✅ バックアップと復元が簡単

管理者の作業効率が大幅に向上します！

## サポート

問題が発生した場合:
1. エラーメッセージを確認
2. CSVフォーマットを確認
3. サンプルファイルと比較
4. デバッグツールを使用
